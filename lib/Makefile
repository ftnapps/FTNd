# Makefile for the library files.
# Copyright (c) 2012-2013 by Robert James Clay.
# Copyright (c) 1997, 2001 by M. Broek.

include ../Makefile.global


COMMON_SRCS	= clcomm.c client.c crc.c semafore.c signame.c charset.c remask.c \
		  attach.c falists.c hdr.c parsedate.c rfcmsg.c unpacker.c rearc.c \
		  batchrd.c ftn.c pktname.c mangle.c sectest.c proglock.c magic.c \
		  dostran.c ftnmsg.c ftnfile.c nodelock.c rawio.c strcasestr.c \
		  execute.c expipe.c getheader.c noderecord.c rfcaddr.c strutil.c \
		  faddr.c gmtoffset.c packet.c rfcdate.c term.c endian.c timers.c \
		  pidinfo.c tmpwork.c virscan.c
COMMON_OBJS	= clcomm.o client.o crc.o semafore.o signame.o charset.o remask.o \
		  ftscprod.o attach.o falists.o hdr.o parsedate.o rfcmsg.o unpacker.o \
		  batchrd.o ftn.o pktname.o mangle.o sectest.o proglock.o rearc.o \
		  dostran.o ftnmsg.o ftnfile.o nodelock.o rawio.o strcasestr.o magic.o \
		  execute.o expipe.o getheader.o noderecord.o rfcaddr.o strutil.o \
		  faddr.o gmtoffset.o packet.o rfcdate.o term.o endian.o timers.o \
		  pidinfo.o tmpwork.o virscan.o
COMMON_HDRS	= ftndlib.h
NODELIST_SRCS	= nodelist.c
NODELIST_OBJS	= nodelist.o
NODELIST_HDRS	= nodelist.h
DBASE_SRCS	= dbcfg.c dbdupe.c dbftn.c dbmsgs.c dbnode.c dbtic.c dbuser.c dbfdb.c
DBASE_OBJS	= dbcfg.o dbdupe.o dbftn.o dbmsgs.o dbnode.o dbtic.o dbuser.o dbfdb.o
DBASE_HDRS	= ftnddb.h
MSGBASE_SRCS	= jammsg.c msg.c msgtext.c
MSGBASE_OBJS	= jammsg.o msg.o msgtext.o
MSGBASE_HDRS	= jam.h jammsg.h jamsys.h msg.h msgtext.h
FTNINET_SRCS	= nntp.c pop3.c smtp.c
FTNINET_OBJS	= nntp.o pop3.o smtp.o
FTNINET_HDRS	= ftninet.h
DIESEL_SRCS	= diesel.c ftndiesel.c strcasestr.c
DIESEL_HDRS	= diesel.h
DIESEL_OBJS	= diesel.o ftndiesel.o strcasestr.o
OTHER_HDRS	= bluewave.h ftnd.h users.h
SRCS		= ${COMMON_SRCS} ${DBASE_SRCS} ${MSGBASE_SRCS} ${FTNINET_SRCS} \
		  ${DIESEL_SRCS} ${NODELIST_SRCS} ${CHC_SRCS}
OBJS		= ${COMMON_OBJS} ${DBASE_OBJS} ${MSGBASE_OBJS} ${FTNINET_OBJS} \
		  ${DIESEL_OBJS} ${NODELIST_OBJS} ${CHC_OBJS}
HDRS		= ${COMMON_HDRS} ${DBASE_HDRS} ${MSGBASE_HDRS} ${FTNINET_HDRS} \
		  ${DIESEL_HDRS} ${NODELIST_HDRS} ${CHC_HDRS} ${OTHER_HDRS}
OTHER		= Makefile README ftscprod.010 mkprod.awk \
		  README.diesel README.macro Diesel.doc nodelist.conf
TARGET		= libftnd.a libdbase.a libmsgbase.a libftninet.a libdiesel.a \
		  libnodelist.a
SLIBS		= ../lib/libftnd.a

#############################################################################

.c.o:
		${CC} ${CFLAGS} ${INCLUDES} ${DEFINES} -c $<

all:		${TARGET}

ftscprod.c:	ftscprod.??? mkprod.awk
		${AWK} -F, -f mkprod.awk ftscprod.??? >ftscprod.c

libftnd.a:	${COMMON_OBJS}
		ar r $@ $?
		${RANLIB} $@

libdbase.a:	${DBASE_OBJS}
		ar r $@ $?
		${RANLIB} $@

libmsgbase.a:	${MSGBASE_OBJS}
		ar r $@ $?
		${RANLIB} $@

libftninet.a:	${FTNINET_OBJS}
		ar r $@ $?
		${RANLIB} $@

libdiesel.a:	${DIESEL_OBJS}
		ar r $@ $?
		${RANLIB} $@

libnodelist.a:	${NODELIST_OBJS}
		ar r $@ $?
		${RANLIB} $@

install:	all
		${INSTALL} -c -o ${OWNER} -g ${GROUP} -m 0444 nodelist.conf ${ETCDIR}

clean:
		rm -f ${TARGET} *.o *.h~ *.c~ ftscprod.c core filelist Makefile.bak

filelist:	Makefile
		BASE=`pwd`; \
		BASE=`basename $${BASE}`; \
		(for f in ${SRCS} ${HDRS} ${OTHER} ${MAPS} ;do echo ${PACKAGE}-${VERSION}/$${BASE}/$$f; done) >filelist

depend:		ftscprod.c
		@rm -f Makefile.bak; \
		mv Makefile Makefile.bak; \
		sed -e '/^# DO NOT DELETE/,$$d' Makefile.bak >Makefile; \
		${ECHO} '# DO NOT DELETE THIS LINE - MAKE DEPEND RELIES ON IT' >>Makefile; \
		${ECHO} '# Dependencies generated by make depend' >>Makefile; \
		for f in ${SRCS} ftscprod.c; \
		do \
			${ECHO} "Dependencies for $$f:\c"; \
			${ECHO} "`basename $$f .c`.o:\c" >>Makefile; \
			for h in `sed -n -e \
				's/^#[ 	]*include[ 	]*"\([^"]*\)".*/\1/p' $$f`; \
			do \
				${ECHO} " $$h\c"; \
				${ECHO} " $$h\c" >>Makefile; \
			done; \
			${ECHO} " done."; \
			${ECHO} "" >>Makefile; \
		done; \
		${ECHO} '# End of generated dependencies' >>Makefile

# DO NOT DELETE THIS LINE - MAKE DEPEND RELIES ON IT
# Dependencies generated by make depend
clcomm.o: ../config.h ftndlib.h
client.o: ../config.h ftndlib.h
crc.o: ../config.h ftndlib.h
semafore.o: ../config.h ftndlib.h
signame.o: ../config.h ftndlib.h
charset.o: ../config.h ftndlib.h
remask.o: ../config.h ftndlib.h
attach.o: ../config.h ftndlib.h
falists.o: ../config.h ftndlib.h
hdr.o: ../config.h ftndlib.h
parsedate.o: ../config.h ftndlib.h
rfcmsg.o: ../config.h ftndlib.h
unpacker.o: ../config.h ftndlib.h
rearc.o: ../config.h ftndlib.h
batchrd.o: ../config.h ftndlib.h
ftn.o: ../config.h ftndlib.h users.h ftnddb.h
pktname.o: ../config.h ftndlib.h users.h ftnddb.h
mangle.o: ../config.h ftndlib.h
sectest.o: ../config.h ftndlib.h
proglock.o: ../config.h ftndlib.h
magic.o: ../config.h ftndlib.h
dostran.o: ../config.h ftndlib.h
ftnmsg.o: ../config.h ftndlib.h
ftnfile.o: ../config.h ftndlib.h
nodelock.o: ../config.h ftndlib.h
rawio.o: ../config.h ftndlib.h
strcasestr.o: ../config.h ftndlib.h
execute.o: ../config.h ftndlib.h
expipe.o: ../config.h ftndlib.h
getheader.o: ../config.h ftndlib.h
noderecord.o: ../config.h ftndlib.h users.h ftnddb.h
rfcaddr.o: ../config.h ftndlib.h
strutil.o: ../config.h ftndlib.h
faddr.o: ../config.h ftndlib.h
gmtoffset.o: ../config.h ftndlib.h
packet.o: ../config.h ftndlib.h users.h ftnddb.h
rfcdate.o: ../config.h ftndlib.h
term.o: ../config.h ftndlib.h users.h
endian.o: ../config.h ftndlib.h
timers.o: ../config.h ftndlib.h
pidinfo.o: ../config.h ftndlib.h
tmpwork.o: ../config.h ftndlib.h
virscan.o: ../config.h ftndlib.h
dbcfg.o: ../config.h ftndlib.h ftnd.h users.h ftnddb.h
dbdupe.o: ../config.h ftndlib.h ftnd.h users.h ftnddb.h
dbftn.o: ../config.h ftndlib.h users.h ftnddb.h
dbmsgs.o: ../config.h ftndlib.h users.h ftnddb.h
dbnode.o: ../config.h ftndlib.h users.h ftnddb.h
dbtic.o: ../config.h ftndlib.h users.h ftnddb.h
dbuser.o: ../config.h ftndlib.h users.h ftnddb.h
dbfdb.o: ../config.h ftndlib.h users.h ftnddb.h
jammsg.o: ../config.h ftndlib.h msgtext.h msg.h jam.h jammsg.h users.h
msg.o: ../config.h ftndlib.h msgtext.h msg.h jammsg.h
msgtext.o: ../config.h ftndlib.h msgtext.h msg.h
nntp.o: ../config.h ftndlib.h ftninet.h
pop3.o: ../config.h ftndlib.h ftninet.h
smtp.o: ../config.h ftndlib.h ftninet.h
diesel.o: ../config.h ftndlib.h diesel.h
ftndiesel.o: ../config.h ftndlib.h diesel.h
strcasestr.o: ../config.h ftndlib.h
nodelist.o: ../config.h ftndlib.h nodelist.h
ftscprod.o: ../config.h ftndlib.h
# End of generated dependencies
