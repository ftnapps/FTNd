# Makefile for mbtask.
# Copyright (c) 1997-2001 by M. Broek.
# $Id: Makefile,v 1.43 2007/05/27 12:50:48 mbse Exp $

include ../Makefile.global

SRCS		= callstat.c scanout.c taskcomm.c taskinfo.c taskstat.c taskibc.c \
		  mbtask.c outstat.c signame.c taskdisk.c taskregs.c taskutil.c \
		  ports.c calllist.c ping.c taskchat.c crc.c pidinfo.c
HDRS		= callstat.h mbtask.h outstat.h signame.h taskdisk.h taskregs.h  taskutil.h \
		  scanout.h taskcomm.h taskinfo.h taskstat.h taskibc.h \
		  ports.h calllist.h ping.h taskchat.h
OBJS		= callstat.o scanout.o taskcomm.o taskinfo.o taskstat.o taskibc.o \
		  mbtask.o outstat.o signame.o taskdisk.o taskregs.o taskutil.o \
		  ports.o calllist.o ping.o taskchat.o crc.o pidinfo.o
SLIBS		= ../lib/libnodelist.a
OTHER		= Makefile issue issue.netbsd

#############################################################################

.c.o:
		${CC} ${CFLAGS} ${INCLUDES} ${DEFINES} -c $<

all:		mbtask

mbtask:		${OBJS} ${SLIBS}
		${CC} ${CFLAGS} -o mbtask ${OBJS} ${LDFLAGS} ${LIBS} ${SLIBS}

clean:
		rm -f mbtask *.o *.h~ *.c~ version.* core filelist Makefile.bak

install:	all
		@if [ "`id -un`" != "root" ] ; then \
			echo; echo " Must be root to install!"; echo; exit 3; \
		fi
		${INSTALL} -c -s -o ${ROWNER} -g ${RGROUP} -m 6711 mbtask   ${BINDIR}
		@if [ ! -f ${ETCDIR}/issue ]; then \
			${INSTALL} -c -o ${OWNER} -g ${GROUP} -m 0644 issue  ${ETCDIR} ; \
			echo "${INSTALL} -c -o ${OWNER} -g ${GROUP} -m 0644 issue  ${ETCDIR}"; \
		fi

filelist:	Makefile
		BASE=`pwd`; \
		BASE=`basename $${BASE}`; \
		(for f in ${SRCS} ${HDRS} ${OTHER} ;do echo ${PACKAGE}-${VERSION}/$${BASE}/$$f; done) >filelist

depend:
	@rm -f Makefile.bak; \
	mv Makefile Makefile.bak; \
	sed -e '/^# DO NOT DELETE/,$$d' Makefile.bak >Makefile; \
	${ECHO} '# DO NOT DELETE THIS LINE - MAKE DEPEND RELIES ON IT' \
		>>Makefile; \
	${ECHO} '# Dependencies generated by make depend' >>Makefile; \
	for f in ${SRCS}; \
	do \
		${ECHO} "Dependencies for $$f:\c"; \
		${ECHO} "`basename $$f .c`.o:\c" >>Makefile; \
		for h in `sed -n -e \
			's/^#[ 	]*include[ 	]*"\([^"]*\)".*/\1/p' $$f`; \
		do \
			${ECHO} " $$h\c"; \
			${ECHO} " $$h\c" >>Makefile; \
		done; \
		${ECHO} " done."; \
		${ECHO} "" >>Makefile; \
	done; \
	${ECHO} '# End of generated dependencies' >>Makefile

# DO NOT DELETE THIS LINE - MAKE DEPEND RELIES ON IT
# Dependencies generated by make depend
callstat.o: ../config.h ../lib/mbselib.h taskutil.h callstat.h
scanout.o: ../config.h ../lib/mbselib.h taskutil.h scanout.h
taskcomm.o: ../config.h ../lib/mbselib.h taskstat.h taskregs.h taskdisk.h taskinfo.h taskutil.h taskchat.h taskcomm.h taskibc.h
taskinfo.o: ../config.h ../lib/mbselib.h taskinfo.h
taskstat.o: ../config.h ../lib/mbselib.h taskstat.h callstat.h outstat.h taskibc.h taskutil.h
taskibc.o: ../config.h ../lib/mbselib.h taskstat.h taskutil.h taskchat.h taskibc.h
mbtask.o: ../config.h ../lib/mbselib.h ../paths.h signame.h taskstat.h taskutil.h taskregs.h taskcomm.h taskdisk.h taskibc.h callstat.h outstat.h ../lib/nodelist.h ports.h calllist.h ping.h taskchat.h mbtask.h
outstat.o: ../config.h ../lib/mbselib.h taskutil.h taskstat.h scanout.h ../lib/nodelist.h callstat.h ports.h outstat.h
signame.o: ../config.h signame.h
taskdisk.o: ../config.h ../lib/mbselib.h taskdisk.h taskutil.h
taskregs.o: ../config.h ../lib/mbselib.h taskstat.h taskregs.h taskchat.h taskutil.h
taskutil.o: ../config.h ../lib/mbselib.h signame.h scanout.h taskutil.h
ports.o: ../config.h ../lib/mbselib.h taskutil.h ../lib/nodelist.h ports.h
calllist.o: ../config.h ../lib/mbselib.h taskstat.h taskutil.h callstat.h outstat.h mbtask.h calllist.h
ping.o: ../config.h ../lib/mbselib.h taskstat.h taskutil.h ping.h
taskchat.o: ../config.h ../lib/mbselib.h taskutil.h taskregs.h taskchat.h taskibc.h
crc.o: ../config.h ../lib/mbselib.h
pidinfo.o: ../config.h ../lib/mbselib.h
# End of generated dependencies
